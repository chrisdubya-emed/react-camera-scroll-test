import{BlendFunction as e,BloomEffect as t,BrightnessContrastEffect as n,ChromaticAberrationEffect as r,ColorAverageEffect as i,ColorDepthEffect as o,DepthEffect as c,EffectComposer as l,RenderPass as s,NormalPass as a,EffectPass as u,DepthOfFieldEffect as d,DotScreenEffect as m,GlitchEffect as f,GlitchMode as p,GodRaysEffect as h,GridEffect as g,HueSaturationEffect as b,NoiseEffect as w,OutlineEffect as E,PixelationEffect as y,ScanlineEffect as v,SelectiveBloomEffect as S,SepiaEffect as x,SSAOEffect as C,SMAAPreset as j,EdgeDetectionMode as T,SMAAImageLoader as P,SMAAEffect as A,TextureEffect as L,ToneMappingEffect as R,VignetteEffect as O,ShockWaveEffect as z}from"postprocessing";import F,{forwardRef as B,useMemo as D,useLayoutEffect as M,createContext as k,useEffect as N,useRef as I,useImperativeHandle as _,useContext as G}from"react";import{Vector2 as H,Vector3 as Y,TextureLoader as q,sRGBEncoding as U,RepeatWrapping as V}from"three";import{useThree as W,useFrame as J,useLoader as K}from"@react-three/fiber";const Q=(t,n=e.NORMAL)=>B((function({blendFunction:e,opacity:r,...i},o){const c=D((()=>new t(i)),[i]);return M((()=>{c.blendMode.blendFunction=e||n,void 0!==r&&(c.blendMode.opacity.value=r)}),[e,c.blendMode,r]),F.createElement("primitive",{ref:o,object:c,dispose:null})})),X=(e,t)=>{const n=e[t];return D((()=>{if(n instanceof H)return(new H).set(n.x,n.y);if(Array.isArray(n)){const[e,t]=n;return(new H).set(e,t)}}),[n])},Z=()=>{try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},$=Q(t,e.SCREEN),ee=Q(n),te=B((function(e,t){const n=X(e,"offset"),i=D((()=>new r({...e,offset:n})),[n,e]);return F.createElement("primitive",{ref:t,object:i,dispose:null})})),ne=B((function({blendFunction:t=e.NORMAL},n){const r=D((()=>new i(t)),[t]);return F.createElement("primitive",{ref:n,object:r,dispose:null})})),re=Q(o),ie=Q(c),oe=k(null),ce=F.memo(B((({children:e,camera:t,scene:n,renderPriority:r=1,autoClear:i=!0,depthBuffer:o,disableNormalPass:c,stencilBuffer:d,multisampling:m=8,frameBufferType:f},p)=>{const{gl:h,scene:g,camera:b,size:w}=W();n=n||g,t=t||b;const[E,y]=D((()=>{const e=new l(h,{depthBuffer:o,stencilBuffer:d,multisampling:Z()?m:0,frameBufferType:f});e.addPass(new s(n,t));const r=c?null:new a(n,t);return r&&e.addPass(r),[e,r]}),[t,h,o,d,m,f,n,c]);N((()=>null==E?void 0:E.setSize(w.width,w.height)),[E,w]),J(((e,t)=>(h.autoClear=i,void E.render(t))),r);const v=I(null);N((()=>{let e;return v.current&&v.current.__r3f&&E&&(e=new u(t,...v.current.__r3f.objects),E.addPass(e),e.renderToScreen=!0),()=>{e&&(null==E||E.removePass(e))}}),[E,e,t]);const S=D((()=>({composer:E,normalPass:y,camera:t,scene:n})),[E,y,t,n]);return _(p,(()=>E),[E]),F.createElement(oe.Provider,{value:S},F.createElement("group",{ref:v},e))}))),le=B((function({target:e,depthTexture:t,...n},r){const{camera:i}=G(oe),o=D((()=>new d(i,n)),[i,n]);return M((()=>{if(e){const t=e instanceof Y?(new Y).set(e.x,e.y,e.z):(new Y).set(e[0],e[1],e[2]);o.target=t}t&&o.setDepthTexture(t.texture,t.packing)}),[e,t,o]),F.createElement("primitive",{ref:r,object:o,dispose:null})})),se=Q(m),ae=B((function({active:e=!0,...t},n){const r=X(t,"delay"),i=X(t,"duration"),o=X(t,"strength"),c=D((()=>new f({...t,delay:r,duration:i,strength:o})),[r,i,t,o]);return M((()=>{c.mode=e?t.mode||p.SPORADIC:p.DISABLED}),[e,c,t.mode]),F.createElement("primitive",{ref:n,object:c,dispose:null})})),ue=B((function(e,t){const{camera:n}=G(oe),r=D((()=>new h(n,e.sun,e)),[n,e]);return F.createElement("primitive",{ref:t,object:r,dispose:null})})),de=B((function({size:e,...t},n){const r=D((()=>new g(t)),[t]);return M((()=>{e&&r.setSize(e.width,e.height)}),[r,e]),F.createElement("primitive",{ref:n,object:r,dispose:null})})),me=Q(b),fe=Q(w,e.COLOR_DODGE),pe=B((function({selection:e=[],selectionLayer:t=10,blendFunction:n,patternTexture:r,edgeStrength:i,pulseSpeed:o,visibleEdgeColor:c,hiddenEdgeColor:l,width:s,height:a,kernelSize:u,blur:d,xRay:m,...f},p){const{scene:h,camera:g}=G(oe),b=D((()=>new E(h,g,{blendFunction:n,patternTexture:r,edgeStrength:i,pulseSpeed:o,visibleEdgeColor:c,hiddenEdgeColor:l,width:s,height:a,kernelSize:u,blur:d,xRay:m})),[n,d,g,i,a,l,u,r,o,h,c,s,m]);return N((()=>{b.clearSelection(),b.setSelection(Array.isArray(e)?e.map((e=>e.current)):[e.current])}),[b,e]),N((()=>{b.selectionLayer=t}),[b,t]),F.createElement("primitive",{ref:p,object:b,dispose:null})})),he=B((function({granularity:e=5},t){const n=D((()=>new y(e)),[e]);return F.createElement("primitive",{ref:t,object:n,dispose:null})})),ge=Q(v,e.OVERLAY),be=B((function({selection:t=[],selectionLayer:n=10,lights:r=[],luminanceThreshold:i,luminanceSmoothing:o,intensity:c,width:l,height:s,kernelSize:a},u){0===r.length&&console.warn("SelectiveBloom requires lights to work.");const{scene:d,camera:m}=G(oe),f=D((()=>new S(d,m,{blendFunction:e.SCREEN,luminanceThreshold:i,luminanceSmoothing:o,intensity:c,width:l,height:s,kernelSize:a})),[m,s,c,a,o,i,d,l]);return N((()=>{f.selection.set(Array.isArray(t)?t.map((e=>e.current)):[t.current])}),[f,t]),N((()=>{f.selection.layer=n}),[f,n]),N((()=>(r.forEach((e=>((e,t)=>{e.current&&e.current.layers.enable(t.selection.layer)})(e,f))),()=>r.forEach((e=>((e,t)=>{e.current&&e.current.layers.disable(t.selection.layer)})(e,f))))),[f,r,n]),F.createElement("primitive",{ref:u,object:f,dispose:null})})),we=Q(x),Ee=B((function(t,n){const{camera:r,normalPass:i}=G(oe),o=D((()=>null===i?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),null):new C(r,i.renderTarget.texture,{blendFunction:e.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,scale:.5,bias:.5,...t})),[r,i,t]);return F.createElement("primitive",{ref:n,object:o,dispose:null})})),ye=B((function({preset:e=j.HIGH,edgeDetectionMode:t=T.COLOR},n){const r=K(P,""),i=D((()=>new A(...r,e,t)),[r,e,t]);return F.createElement("primitive",{ref:n,object:i,dispose:null})})),ve=B((function({textureSrc:e,texture:t,...n},r){const i=K(q,e);M((()=>{i.encoding=U,i.wrapS=i.wrapT=V}),[i]);const o=D((()=>new L({...n,texture:i||t})),[n,i,t]);return F.createElement("primitive",{ref:r,object:o,dispose:null})})),Se=Q(R),xe=Q(O),Ce=Q(z);export{$ as Bloom,ee as BrightnessContrast,te as ChromaticAberration,ne as ColorAverage,re as ColorDepth,ie as Depth,le as DepthOfField,se as DotScreen,ce as EffectComposer,oe as EffectComposerContext,ae as Glitch,ue as GodRays,de as Grid,me as HueSaturation,fe as Noise,pe as Outline,he as Pixelation,ye as SMAA,Ee as SSAO,ge as Scanline,be as SelectiveBloom,we as Sepia,Ce as ShockWave,ve as Texture,Se as ToneMapping,xe as Vignette};
